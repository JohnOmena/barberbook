{"nodes":[
{"name":"Gemini_DateNormalize_AG","type":"n8n-nodes-base.httpRequest","typeVersion":1,"parameters":{"method":"POST","url":"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent","jsonParameters":true,"options":{"responseFormat":"json","ignoreResponseCode":true},"headerParametersJson":"{\"x-goog-api-key\":\"AIzaSyAQdhMQ-aMy0H7rW3QuQ29nhImz5GhlYLY\",\"Content-Type\":\"application/json\"}","bodyParametersJson":"{\"contents\":[{\"role\":\"user\",\"parts\":[{\"text\":\"Saida apenas JSON {\\\"date\\\": \\\"YYYY-MM-DD\\\"|null}. Base: {{$json.text}} {{$json.date||''}}\"}]}],\"generationConfig\":{\"responseMimeType\":\"application/json\"}}"},"position":[640,0]},
{"name":"ApplyDate_AG","type":"n8n-nodes-base.function","typeVersion":1,"parameters":{"functionCode":"let d=$json.date||($json.candidates?.[0]?.content?.parts?.[0]?.text)||'';try{if(typeof d==='string'&&d.trim().startsWith('{')){d=JSON.parse(d).date||'';}}catch{};const ok=/^\\d{4}-\\d{2}-\\d{2}$/.test(d);return [{json:{...$json,date:d,validDate:ok}}];"},"position":[800,0]},
{"name":"IfDateValid_AG","type":"n8n-nodes-base.if","typeVersion":1,"parameters":{"conditions":{"boolean":[{"value1":"={{$json.validDate}}"}]}},"position":[960,0]},
{"name":"WAHA_DateInvalid_AG","type":"n8n-nodes-base.httpRequest","typeVersion":1,"parameters":{"method":"POST","url":"http://waha:3000/api/sendText","jsonParameters":true,"headerParametersJson":"{\"Content-Type\":\"application/json\"}","bodyParametersJson":"{\"session\":\"{{$json.session}}\",\"chatId\":\"{{$json.chatId}}\",\"text\":\"Data invalida. Use YYYY-MM-DD.\",\"reply_to\":\"{{$json.messageId}}\"}"},"position":[1120,-80]}
]}
