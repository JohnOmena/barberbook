{"nodes":[
{"name":"ExtractIdOrTime_CA","type":"n8n-nodes-base.function","typeVersion":1,"parameters":{"functionCode":"const t=String($json.text||'');const id=(t.match(/[0-9a-fA-F-]{8,}/)||[])[0];const hhmm=(t.match(/\\b([01]?\\d|2[0-3]):[0-5]\\d\\b/)||[])[0];return [{json:{...$json,appointmentId:id||'',needIdTime:!(id||hhmm)}}];"},"position":[0,300]},
{"name":"IfNeedIdTime_CA","type":"n8n-nodes-base.if","typeVersion":1,"parameters":{"conditions":{"boolean":[{"value1":"={{$json.needIdTime}}"}]}},"position":[160,300]},
{"name":"WAHA_AskIdTime_CA","type":"n8n-nodes-base.httpRequest","typeVersion":1,"parameters":{"method":"POST","url":"http://waha:3000/api/sendText","jsonParameters":true,"headerParametersJson":"{\"Content-Type\":\"application/json\"}","bodyParametersJson":"{\"session\":\"{{$json.session}}\",\"chatId\":\"{{$json.chatId}}\",\"text\":\"Envie o codigo/horario.\",\"reply_to\":\"{{$json.messageId}}\"}"},"position":[320,240]},
{"name":"API_Cancel_CA","type":"n8n-nodes-base.httpRequest","typeVersion":1,"parameters":{"method":"POST","url":"http://barberbook-api:8080/api/cancel","jsonParameters":true,"options":{"fullResponse":true},"headerParametersJson":"{\"Content-Type\":\"application/json\"}","bodyParametersJson":"{\"appointmentId\":\"{{$json.appointmentId || ''}}\",\"reason\":\"Solicitado via WhatsApp\"}"},"position":[320,360]},
{"name":"IfStatus200_CA","type":"n8n-nodes-base.if","typeVersion":1,"parameters":{"conditions":{"number":[{"value1":"={{$json.statusCode}}","operation":"equal","value2":200}]}},"position":[480,360]},
{"name":"WAHA_CancelOK_CA","type":"n8n-nodes-base.httpRequest","typeVersion":1,"parameters":{"method":"POST","url":"http://waha:3000/api/sendText","jsonParameters":true,"headerParametersJson":"{\"Content-Type\":\"application/json\"}","bodyParametersJson":"{\"session\":\"{{$json.session}}\",\"chatId\":\"{{$json.chatId}}\",\"text\":\"Cancelado.\",\"reply_to\":\"{{$json.messageId}}\"}"},"position":[640,320]},
{"name":"WAHA_CancelFail_CA","type":"n8n-nodes-base.httpRequest","typeVersion":1,"parameters":{"method":"POST","url":"http://waha:3000/api/sendText","jsonParameters":true,"headerParametersJson":"{\"Content-Type\":\"application/json\"}","bodyParametersJson":"{\"session\":\"{{$json.session}}\",\"chatId\":\"{{$json.chatId}}\",\"text\":\"Nao consegui cancelar.\",\"reply_to\":\"{{$json.messageId}}\"}"},"position":[640,400]}
]}
